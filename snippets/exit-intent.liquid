{%- if settings.show_exit_intent -%}
    <div id="ExitIntentPopup" class="exit-intent-overlay" style="display:none;">
      <div class="exit-intent-box">
        <button class="exit-intent-close" onclick="closeExitPopup()">
          {% render 'icon-close' %}
        </button>
        
        <div class="exit-intent-content">
          <h2 class="exit-title">WAIT! DON'T GO</h2>
          <p class="exit-subtext">Your back will thank you later. Complete your order in the next <b>10:00</b> minutes and take an extra <b>$50 OFF</b>.</p>
          
          <div class="exit-coupon-box">
            <span class="coupon-label">USE CODE AT CHECKOUT</span>
            <div class="coupon-code">{{ settings.exit_intent_discount | upcase }}</div>
          </div>
    
          <button class="atc-btn" onclick="closeExitPopup()">
            RECLAIM MY HEALTH
          </button>
          
          <p class="exit-footer">Applied at the last step of checkout</p>
        </div>
      </div>
    </div>
    
    <style>
      .exit-intent-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.85);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999; padding: 20px; backdrop-filter: blur(10px);
      }
      .exit-intent-box {
        background: #fff; width: 100%; max-width: 500px;
        border-radius: 24px; position: relative; padding: 50px 40px;
        text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.3);
      }
      .exit-intent-close {
        position: absolute; top: 20px; right: 20px;
        background: none; border: none; cursor: pointer; padding: 10px; color: #999;
      }
      .exit-title { font-size: 3.8rem; font-weight: 800; color: var(--color-urgency); margin-bottom: 15px; }
      .exit-subtext { font-size: 1.6rem; color: #666; line-height: 1.5; margin-bottom: 30px; }
      .exit-coupon-box {
        background: #f5f5f7; border: 2px dashed #000;
        padding: 20px; border-radius: 12px; margin-bottom: 30px;
      }
      .coupon-label { display: block; font-size: 1.1rem; font-weight: 800; margin-bottom: 8px; opacity: 0.5; }
      .coupon-code { font-family: monospace; font-size: 2.8rem; font-weight: 800; letter-spacing: 2px; }
      .exit-footer { font-size: 1.2rem; opacity: 0.4; margin-top: 20px; }
    </style>
    
    <script>
      function closeExitPopup() {
        document.getElementById('ExitIntentPopup').style.display = 'none';
        sessionStorage.setItem('AEOall_exit_dismissed', 'true');
      }
    
      window.addEventListener('load', () => {
        // 只有桌面端触发鼠标移出逻辑
        if (window.innerWidth > 990) {
          document.addEventListener('mouseleave', (e) => {
            if (e.clientY < 0 && !sessionStorage.getItem('AEOall_exit_dismissed')) {
              document.getElementById('ExitIntentPopup').style.display = 'flex';
            }
          });
        }
      });
    </script>
    {%- endif -%}