<div id="MobileStickyCTA" class="mobile-sticky-cta">
  <div class="sticky-cta-content">
    <div class="sticky-info">
      <span class="sticky-title">{{ product.title | truncate: 25 }}</span>
      <span class="sticky-price" data-sticky-price>{{ product.selected_or_first_available_variant.price | money }}</span>
    </div>
    <button class="sticky-atc-btn" type="button" style="height: 50px; width: auto; padding: 0 2.5rem;">
      ADD TO CART
    </button>
  </div>
</div>

{% capture sticky_variants_json %}{{ product.variants | json }}{% endcapture %}
<div id="MobileStickyVariantsData" class="visually-hidden" aria-hidden="true">{{ sticky_variants_json | escape }}</div>

<style>
  .mobile-sticky-cta {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid #eee; padding: 1.2rem 2rem; z-index: 900;
    transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 -10px 30px rgba(0,0,0,0.05);
  }
  .mobile-sticky-cta.visible { transform: translateY(0); }
  .sticky-cta-content { display: flex; justify-content: space-between; align-items: center; }
  .sticky-info { display: flex; flex-direction: column; }
  .sticky-title { font-size: 1.1rem; font-weight: 700; opacity: 0.6; }
  .sticky-price { font-size: 1.6rem; font-weight: 800; color: var(--color-accent); }
  @media screen and (min-width: 990px) { .mobile-sticky-cta { display: none; } }
</style>

<script>
  (() => {
    const sticky = document.getElementById('MobileStickyCTA');
    const mainBtn = document.querySelector('.section-product-main #ProductSubmitButton-main');
    const stickyBtn = sticky?.querySelector('.sticky-atc-btn');
    const stickyPrice = sticky?.querySelector('[data-sticky-price]');
    const variantInput = document.querySelector('#product-form-main [name="id"]');

    if (!sticky || !mainBtn || !stickyBtn) return;

    const rawVariants = document.getElementById('MobileStickyVariantsData')?.textContent || '[]';
    const variants = JSON.parse(rawVariants);

    const updateStickyPrice = () => {
      if (!stickyPrice || !variantInput) return;
      const currentId = Number(variantInput.value);
      const currentVariant = variants.find((v) => Number(v.id) === currentId);
      if (!currentVariant) return;

      if (window.Shopify && typeof window.Shopify.formatMoney === 'function') {
        stickyPrice.textContent = window.Shopify.formatMoney(currentVariant.price, window.routes?.money_format || '${{amount}}');
      } else {
        stickyPrice.textContent = (currentVariant.price / 100).toFixed(2);
      }
    };

    window.addEventListener('scroll', () => {
      const rect = mainBtn.getBoundingClientRect();
      sticky.classList.toggle('visible', rect.bottom < 0);
    });

    stickyBtn.addEventListener('click', () => mainBtn.click());

    if (variantInput) variantInput.addEventListener('change', updateStickyPrice);

    updateStickyPrice();
  })();
</script>