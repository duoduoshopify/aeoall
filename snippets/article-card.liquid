{% comment %}
  Article Card Component - 文章卡片组件
  
  参数:
  - article: 文章对象 (必需)
  - show_image: 显示图片
  - show_date: 显示日期
  - show_author: 显示作者
  - show_excerpt: 显示摘要
  - show_reading_time: 显示阅读时间
  - show_tags: 显示标签
  - current_tags: 当前文章标签 (用于高亮匹配)
  - layout: 布局 (grid/list/carousel)
{% endcomment %}

{%- liquid
  assign show_image = show_image | default: true
  assign show_date = show_date | default: true
  assign show_author = show_author | default: false
  assign show_excerpt = show_excerpt | default: true
  assign show_reading_time = show_reading_time | default: true
  assign show_tags = show_tags | default: true
  assign layout = layout | default: 'grid'
  
  # 计算阅读时间 (假设每分钟200字)
  assign word_count = article.content | strip_html | split: ' ' | size
  assign reading_time = word_count | divided_by: 200
  if reading_time < 1
    assign reading_time = 1
  endif
  
  # 检查标签匹配
  assign has_matching_tags = false
  if current_tags and article.tags.size > 0
    for tag in article.tags
      if current_tags contains tag
        assign has_matching_tags = true
        break
      endif
    endfor
  endif
-%}

<article class="article-card article-card--{{ layout }}{% if has_matching_tags %} article-card--matched{% endif %}">
  {%- if show_image and article.image -%}
    <a href="{{ article.url }}" class="article-card__image-wrapper">
      <div class="article-card__image">
        <img
          srcset="
            {%- if article.image.width >= 165 -%}{{ article.image | image_url: width: 165 }} 165w,{%- endif -%}
            {%- if article.image.width >= 360 -%}{{ article.image | image_url: width: 360 }} 360w,{%- endif -%}
            {%- if article.image.width >= 533 -%}{{ article.image | image_url: width: 533 }} 533w,{%- endif -%}
            {%- if article.image.width >= 720 -%}{{ article.image | image_url: width: 720 }} 720w,{%- endif -%}
            {{ article.image | image_url }} {{ article.image.width }}w
          "
          src="{{ article.image | image_url: width: 533 }}"
          sizes="(min-width: 990px) {% if layout == 'list' %}400px{% else %}calc((100vw - 10rem) / 3){% endif %}, (min-width: 750px) calc((100vw - 10rem) / 2), calc(100vw - 3rem)"
          alt="{{ article.image.alt | escape }}"
          loading="lazy"
          width="{{ article.image.width }}"
          height="{{ article.image.height }}"
        >
        
        {%- if has_matching_tags -%}
          <span class="article-card__badge">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            {{ 'blogs.article.related_topic' | t }}
          </span>
        {%- endif -%}
      </div>
    </a>
  {%- endif -%}

  <div class="article-card__content">
    {%- if show_tags and article.tags.size > 0 -%}
      <div class="article-card__tags">
        {%- for tag in article.tags limit: 3 -%}
          <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="article-card__tag{% if current_tags contains tag %} article-card__tag--matched{% endif %}">
            {{ tag }}
          </a>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <h3 class="article-card__title">
      <a href="{{ article.url }}">{{ article.title | escape }}</a>
    </h3>

    <div class="article-card__meta">
      {%- if show_date -%}
        <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}" class="article-card__date">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          {{ article.published_at | time_tag: format: 'abbreviated_date' }}
        </time>
      {%- endif -%}

      {%- if show_author -%}
        <span class="article-card__author">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          {{ article.author }}
        </span>
      {%- endif -%}

      {%- if show_reading_time -%}
        <span class="article-card__reading-time">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          {{ reading_time }} {{ 'blogs.article.min_read' | t }}
        </span>
      {%- endif -%}
    </div>

    {%- if show_excerpt -%}
      {%- if article.excerpt.size > 0 -%}
        <div class="article-card__excerpt">
          {{ article.excerpt | strip_html | truncatewords: 25 }}
        </div>
      {%- elsif article.content.size > 0 -%}
        <div class="article-card__excerpt">
          {{ article.content | strip_html | truncatewords: 25 }}
        </div>
      {%- endif -%}
    {%- endif -%}

    <a href="{{ article.url }}" class="article-card__link">
      {{ 'blogs.article.read_more' | t }}
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>
</article>

<style>
  .article-card {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: rgb(var(--color-background));
    border: 1px solid rgb(var(--color-border));
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .article-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .article-card--matched {
    border-color: rgb(var(--color-accent) / 0.3);
  }

  .article-card--list {
    flex-direction: row;
  }

  .article-card--list .article-card__image-wrapper {
    flex: 0 0 300px;
  }

  .article-card__image-wrapper {
    display: block;
    overflow: hidden;
    position: relative;
  }

  .article-card__image {
    position: relative;
    padding-bottom: 66.67%; /* 3:2 aspect ratio */
    overflow: hidden;
  }

  .article-card--list .article-card__image {
    padding-bottom: 100%;
  }

  .article-card__image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }

  .article-card:hover .article-card__image img {
    transform: scale(1.05);
  }

  .article-card__badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgb(var(--color-accent));
    color: rgb(var(--color-background));
    font-size: 1.2rem;
    font-weight: 600;
    border-radius: 20px;
    z-index: 1;
  }

  .article-card__badge svg {
    width: 16px;
    height: 16px;
  }

  .article-card__content {
    padding: 2rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .article-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .article-card__tag {
    display: inline-block;
    padding: 0.4rem 1rem;
    background: rgb(var(--color-background-secondary));
    color: rgb(var(--color-text) / 0.8);
    font-size: 1.2rem;
    font-weight: 500;
    border-radius: 4px;
    text-decoration: none;
    transition: all 0.2s;
  }

  .article-card__tag:hover {
    background: rgb(var(--color-accent) / 0.1);
    color: rgb(var(--color-accent));
  }

  .article-card__tag--matched {
    background: rgb(var(--color-accent) / 0.1);
    color: rgb(var(--color-accent));
    border: 1px solid rgb(var(--color-accent) / 0.3);
  }

  .article-card__title {
    margin: 0 0 1rem;
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1.3;
  }

  .article-card__title a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s;
  }

  .article-card__title a:focus-visible,
  .article-card__link:focus-visible,
  .article-card__tag:focus-visible {
    outline: 2px solid rgba(var(--color-text), 0.35);
    outline-offset: 2px;
    border-radius: 6px;
  }

  .article-card__title a:hover {
    color: rgb(var(--color-accent));
  }

  .article-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-bottom: 1rem;
    font-size: 1.2rem;
    color: rgb(var(--color-text) / 0.7);
  }

  .article-card__meta > * {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .article-card__meta svg {
    width: 14px;
    height: 14px;
  }

  .article-card__excerpt {
    margin-bottom: 1.5rem;
    color: rgb(var(--color-text) / 0.8);
    font-size: 1.45rem;
    line-height: 1.6;
    flex-grow: 1;
  }

  .article-card__link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: rgb(var(--color-accent));
    font-weight: 600;
    font-size: 1.4rem;
    text-decoration: none;
    transition: gap 0.2s;
  }

  .article-card__link:hover {
    gap: 1rem;
  }

  .article-card__link svg {
    width: 16px;
    height: 16px;
  }

  @media (max-width: 749px) {
    .article-card--list {
      flex-direction: column;
    }

    .article-card--list .article-card__image-wrapper {
      flex: none;
    }

    .article-card__content {
      padding: 1.5rem;
    }

    .article-card__title {
      font-size: 1.6rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .article-card,
    .article-card__image img,
    .article-card__link,
    .article-card__title a,
    .article-card__tag {
      transition: none !important;
    }
  }
</style>
