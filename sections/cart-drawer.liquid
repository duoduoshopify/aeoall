{{ 'component-cart-drawer.css' | asset_url | stylesheet_tag }}

<cart-drawer class="drawer{% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    <div class="drawer__inner" role="dialog" aria-modal="true" aria-label="Your cart" tabindex="-1">
      
      <!-- Header -->
      <div class="drawer__header">
        <h2 class="drawer__heading">YOUR CART ({{ cart.item_count }})</h2>
        <button class="drawer__close" type="button" onclick="this.closest('cart-drawer').close()" aria-label="Close">
          {% render 'icon-close' %}
        </button>
      </div>

      {%- if cart == empty -%}
        <!-- Empty State -->
        <div class="drawer__inner-empty">
          {% render 'icon-cart-empty' %}
          <p>Looking for inspiration?</p>
          <a href="{{ routes.all_products_collection_url }}" class="atc-btn">SHOP BEST SELLERS</a>
        </div>
      {%- else -%}
        
        <!-- Free Shipping Goal (DTC Conversion Tool) -->
        {%- if section.settings.show_free_shipping_bar -%}
        <div class="shipping-goal-wrapper">
          {%- liquid
            assign threshold = section.settings.free_shipping_threshold | times: 100
            assign cart_total = cart.total_price
            assign remaining_amount = threshold | minus: cart_total
            assign progress_percent = cart_total | times: 100 | divided_by: threshold
            if progress_percent > 100
              assign progress_percent = 100
            endif
          -%}
          <div class="shipping-goal-text">
            {%- if remaining_amount > 0 -%}
              {%- assign remaining_money = remaining_amount | money -%}
              <span>You're <b>{{ remaining_money }}</b> away from <b>FREE SHIPPING</b></span>
            {%- else -%}
              <span>ðŸŽ‰ You've unlocked <b>FREE SHIPPING</b></span>
            {%- endif -%}
          </div>
          <div class="shipping-progress-bar">
            <div class="shipping-progress-fill" style="width: {{ progress_percent }}%;"></div>
          </div>
        </div>
        {%- endif -%}

        <!-- Cart Items (AJAX Target) -->
        <div class="drawer__contents" id="CartDrawer-Contents">
          <div class="drawer__cart-items-wrapper">
            {%- for item in cart.items -%}
              <div class="cart-item" id="CartDrawer-Item-{{ item.index | plus: 1 }}">
                <div class="cart-item__media">
                  {% if item.image %}
                    <img src="{{ item.image | image_url: width: 200 }}" alt="{{ item.product.title | escape }}" loading="lazy" width="200" height="{{ 200 | divided_by: item.image.aspect_ratio | ceil }}">
                  {% endif %}
                </div>
                <div class="cart-item__details">
                  <div class="cart-item__info">
                    <a href="{{ item.url }}" class="cart-item__name">{{ item.product.title | escape }}</a>
                    {%- if item.product.has_only_default_variant == false -%}
                      <p class="cart-item__option">{{ item.variant.title }}</p>
                    {%- endif -%}
                  </div>

                  <div class="cart-item__footer">
                    <div class="quantity-selector" data-index="{{ item.index | plus: 1 }}">
                      <button type="button" name="minus" data-qty-btn>-</button>
                      <input type="number" value="{{ item.quantity }}" min="0" data-qty-input>
                      <button type="button" name="plus" data-qty-btn>+</button>
                    </div>
                    <div class="cart-item__price-group">
                      <span class="cart-item__price">{{ item.final_line_price | money }}</span>
                      <button class="cart-item__remove" data-remove-item data-index="{{ item.index | plus: 1 }}">Remove</button>
                    </div>
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </div>

        <!-- Footer -->
        <div class="drawer__footer">
          <div class="totals">
            <h3 class="totals__subtotal">SUBTOTAL</h3>
            <p class="totals__subtotal-value">{{ cart.total_price | money_with_currency }}</p>
          </div>
          <p class="tax-note">Shipping, taxes, and discounts calculated at checkout.</p>
          <form action="{{ routes.cart_url }}" method="post">
            <button type="submit" name="checkout" class="atc-btn" style="width: 100%;">
              SECURE CHECKOUT
            </button>
          </form>
        </div>
      {%- endif -%}
    </div>
  </div>
</cart-drawer>

{% schema %}
{
  "name": "Cart Drawer",
  "class": "cart-drawer-section",
  "settings": [
    {
      "type": "header",
      "content": "Free Shipping"
    },
    {
      "type": "checkbox",
      "id": "show_free_shipping_bar",
      "label": "Show free shipping progress bar",
      "default": true
    },
    {
      "type": "number",
      "id": "free_shipping_threshold",
      "label": "Free shipping threshold",
      "default": 100,
      "info": "Amount in your store currency"
    },
    {
      "type": "text",
      "id": "free_shipping_message",
      "label": "Free shipping message",
      "default": "You're {amount} away from free shipping!"
    },
    {
      "type": "text",
      "id": "free_shipping_success_message",
      "label": "Success message",
      "default": "You've unlocked free shipping!"
    }
  ]
}
{% endschema %}