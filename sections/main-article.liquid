{% comment %}
  Main Article Section - 文章内容
{% endcomment %}

<article class="article section-{{ section.id }}" data-section="{{ section.id }}">
  <div class="page-width page-width--narrow">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'featured_image' -%}
          {%- if article.image -%}
            <div class="article__featured-image" {{ block.shopify_attributes }}>
              <img
                srcset="
                  {%- if article.image.width >= 350 -%}{{ article.image | image_url: width: 350 }} 350w,{%- endif -%}
                  {%- if article.image.width >= 750 -%}{{ article.image | image_url: width: 750 }} 750w,{%- endif -%}
                  {%- if article.image.width >= 1100 -%}{{ article.image | image_url: width: 1100 }} 1100w,{%- endif -%}
                  {%- if article.image.width >= 1500 -%}{{ article.image | image_url: width: 1500 }} 1500w,{%- endif -%}
                  {{ article.image | image_url }} {{ article.image.width }}w
                "
                sizes="(min-width: 750px) 750px, calc(100vw - 3rem)"
                src="{{ article.image | image_url: width: 1100 }}"
                loading="eager"
                fetchpriority="high"
                width="{{ article.image.width }}"
                height="{{ article.image.height }}"
                alt="{{ article.image.alt | escape }}"
              >
            </div>
          {%- endif -%}

        {%- when 'title' -%}
          <header class="article__header" {{ block.shopify_attributes }}>
            <h1 class="article__title">{{ article.title }}</h1>
          </header>

        {%- when 'meta' -%}
          <div class="article__meta" {{ block.shopify_attributes }}>
            {%- if block.settings.show_date -%}
              <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
                {{ article.published_at | time_tag: format: 'date' }}
              </time>
            {%- endif -%}

            {%- if block.settings.show_author -%}
              <span class="article__author">
                {{ 'blogs.article.by_author' | t: author: article.author }}
              </span>
            {%- endif -%}
          </div>

        {%- when 'content' -%}
          <div class="article__content rte" {{ block.shopify_attributes }}>
            {{ article.content }}
          </div>

        {%- when 'share' -%}
          <div class="article__share" {{ block.shopify_attributes }}>
            {%- if block.settings.share_label != blank -%}
              <span class="article__share-label">{{ block.settings.share_label }}</span>
            {%- endif -%}
            {% render 'social-icons', share_url: article.url, share_title: article.title %}
          </div>

      {%- endcase -%}
    {%- endfor -%}

    {%- if section.settings.show_comments and blog.comments_enabled? -%}
      <div class="article__comments">
        <h2 class="article__comments-title">{{ 'blogs.comments.title' | t }}</h2>
        
        {%- paginate article.comments by 5 -%}
          {%- if article.comments_count > 0 -%}
            <div class="article__comments-list">
              {%- for comment in article.comments -%}
                <div class="article__comment">
                  <div class="article__comment-header">
                    <strong>{{ comment.author }}</strong>
                    <time datetime="{{ comment.created_at | date: '%Y-%m-%d' }}">
                      {{ comment.created_at | time_tag: format: 'date' }}
                    </time>
                  </div>
                  <div class="article__comment-content rte">
                    {{ comment.content }}
                  </div>
                </div>
              {%- endfor -%}
            </div>

            {%- if paginate.pages > 1 -%}
              {% render 'pagination', paginate: paginate %}
            {%- endif -%}
          {%- endif -%}
        {%- endpaginate -%}

        <div class="article__comment-form">
          {% form 'new_comment', article %}
            <h3>{{ 'blogs.comments.form_title' | t }}</h3>

            {%- if form.posted_successfully? -%}
              <div class="form-message form-message--success">
                {%- if blog.moderated? -%}
                  {{ 'blogs.comments.success_moderated' | t }}
                {%- else -%}
                  {{ 'blogs.comments.success' | t }}
                {%- endif -%}
              </div>
            {%- endif -%}

            <div class="form-row">
              <label for="comment-author">{{ 'blogs.comments.name' | t }}</label>
              <input type="text" id="comment-author" name="comment[author]" value="{{ form.author }}" required>
            </div>

            <div class="form-row">
              <label for="comment-email">{{ 'blogs.comments.email' | t }}</label>
              <input type="email" id="comment-email" name="comment[email]" value="{{ form.email }}" required>
            </div>

            <div class="form-row">
              <label for="comment-body">{{ 'blogs.comments.message' | t }}</label>
              <textarea id="comment-body" name="comment[body]" required>{{ form.body }}</textarea>
            </div>

            <button type="submit" class="button button--primary">
              {{ 'blogs.comments.post' | t }}
            </button>
          {% endform %}
        </div>
      </div>
    {%- endif -%}
  </div>
</article>

<style>
  .page-width--narrow {
    max-width: 800px;
  }

  .article__featured-image {
    margin-bottom: 4rem;
    border-radius: 8px;
    overflow: hidden;
  }

  .article__featured-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .article__header {
    margin-bottom: 2rem;
    text-align: center;
  }

  .article__title {
    margin: 0;
    font-size: 4rem;
    font-weight: 800;
    line-height: 1.2;
  }

  .article__meta {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 4rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid rgb(var(--color-border));
    font-size: 1.4rem;
    color: rgb(var(--color-text) / 0.7);
  }

  .article__content {
    margin-bottom: 4rem;
    font-size: 1.8rem;
    line-height: 1.8;
  }

  .article__content h2 {
    margin: 3rem 0 1.5rem;
    font-size: 2.8rem;
  }

  .article__content h3 {
    margin: 2.5rem 0 1.5rem;
    font-size: 2.2rem;
  }

  .article__content p {
    margin-bottom: 1.5rem;
  }

  .article__content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 2rem 0;
  }

  .article__share {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 2rem 0;
    border-top: 1px solid rgb(var(--color-border));
    border-bottom: 1px solid rgb(var(--color-border));
    margin-bottom: 4rem;
  }

  .article__share-label {
    font-weight: 600;
  }

  .article__comments {
    margin-top: 6rem;
  }

  .article__comments-title {
    margin-bottom: 3rem;
    font-size: 2.8rem;
  }

  .article__comment {
    padding: 2rem;
    margin-bottom: 2rem;
    background: rgb(var(--color-background-secondary));
    border-radius: 8px;
  }

  .article__comment-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    font-size: 1.4rem;
  }

  .article__comment-content {
    color: rgb(var(--color-text) / 0.8);
  }

  .article__comment-form {
    margin-top: 4rem;
    padding: 3rem;
    background: rgb(var(--color-background-secondary));
    border-radius: 8px;
  }

  .form-row {
    margin-bottom: 2rem;
  }

  .form-row label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .form-row input,
  .form-row textarea {
    width: 100%;
    padding: 1rem;
    border: 1px solid rgb(var(--color-border));
    border-radius: 4px;
    font-size: 1.4rem;
  }

  .form-row textarea {
    min-height: 150px;
    resize: vertical;
  }

  @media (max-width: 749px) {
    .article__title {
      font-size: 3rem;
    }

    .article__content {
      font-size: 1.6rem;
    }
  }
</style>

{% schema %}
{
  "name": "Article",
  "class": "section-article",
  "blocks": [
    {
      "type": "featured_image",
      "name": "Featured Image",
      "limit": 1
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "meta",
      "name": "Article Info",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_date",
          "label": "Show date",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_author",
          "label": "Show author",
          "default": true
        }
      ]
    },
    {
      "type": "content",
      "name": "Content",
      "limit": 1
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "Share label",
          "default": "Share this article"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "checkbox",
      "id": "show_comments",
      "label": "Show comments",
      "default": true
    }
  ]
}
{% endschema %}
