{% comment %}
  Main Blog Section - 博客列表
{% endcomment %}

{%- liquid
  assign posts_per_page = section.settings.posts_per_page | default: 12
  assign blog_show_author = section.settings.blog_show_author
  assign blog_show_date = section.settings.blog_show_date
  assign blog_show_excerpt = section.settings.blog_show_excerpt
  assign show_featured_image = section.settings.show_featured_image
  assign image_ratio = section.settings.image_ratio
  assign layout = section.settings.layout | default: 'grid'
-%}

<div class="blog-section section-{{ section.id }}" data-section="{{ section.id }}">
  <div class="page-width">
    {%- if blog.articles_count > 0 -%}
      <div class="blog-articles blog-articles--{{ layout }}">
        {%- paginate blog.articles by posts_per_page -%}
          <div class="blog-articles__grid">
            {%- for article in blog.articles -%}
              <article class="blog-article-card">
                {%- if show_featured_image and article.image -%}
                  <a href="{{ article.url }}" class="blog-article-card__image-wrapper">
                    <div class="blog-article-card__image media media--{{ image_ratio }}">
                      <img
                        srcset="
                          {%- if article.image.width >= 165 -%}{{ article.image | image_url: width: 165 }} 165w,{%- endif -%}
                          {%- if article.image.width >= 360 -%}{{ article.image | image_url: width: 360 }} 360w,{%- endif -%}
                          {%- if article.image.width >= 533 -%}{{ article.image | image_url: width: 533 }} 533w,{%- endif -%}
                          {%- if article.image.width >= 720 -%}{{ article.image | image_url: width: 720 }} 720w,{%- endif -%}
                          {%- if article.image.width >= 940 -%}{{ article.image | image_url: width: 940 }} 940w,{%- endif -%}
                          {%- if article.image.width >= 1066 -%}{{ article.image | image_url: width: 1066 }} 1066w,{%- endif -%}
                          {{ article.image | image_url }} {{ article.image.width }}w
                        "
                        src="{{ article.image | image_url: width: 533 }}"
                        sizes="(min-width: 990px) {% if layout == 'list' %}100vw{% else %}calc((100vw - 10rem) / 3){% endif %}, (min-width: 750px) calc((100vw - 10rem) / 2), calc(100vw - 3rem)"
                        alt="{{ article.image.alt | escape }}"
                        loading="lazy"
                        width="{{ article.image.width }}"
                        height="{{ article.image.height }}"
                      >
                    </div>
                  </a>
                {%- else -%}
                  <a href="{{ article.url }}" class="blog-article-card__image-wrapper">
                    <div class="blog-article-card__image media media--{{ image_ratio }}" style="display: flex; align-items: center; justify-content: center; background: #f5f5f7;">
                      {{ 'image' | placeholder_svg_tag: 'placeholder-svg', 'blog-card-svg' }}
                    </div>
                  </a>
                {%- endif -%}

                <div class="blog-article-card__content">
                  <div class="blog-article-card__info">
                    {%- if blog_show_date -%}
                      <span class="blog-article-card__date">
                        {{ article.published_at | time_tag: format: 'date' }}
                      </span>
                    {%- endif -%}

                    {%- if blog_show_author -%}
                      <span class="blog-article-card__author">
                        {{ 'blogs.article.by_author' | t: author: article.author }}
                      </span>
                    {%- endif -%}
                  </div>

                  <h2 class="blog-article-card__title">
                    <a href="{{ article.url }}">{{ article.title | escape }}</a>
                  </h2>

                  {%- if blog_show_excerpt -%}
                    {%- if article.excerpt.size > 0 -%}
                      <div class="blog-article-card__excerpt rte">
                        {{ article.excerpt | strip_html | truncatewords: 30 }}
                      </div>
                    {%- endif -%}
                  {%- endif -%}

                  <a href="{{ article.url }}" class="blog-article-card__link">
                    {{ 'blogs.article.read_more' | t }}
                    {% render 'icon-arrow-right' %}
                  </a>
                </div>
              </article>
            {%- endfor -%}
          </div>

          {%- if paginate.pages > 1 -%}
            {% render 'pagination', paginate: paginate %}
          {%- endif -%}
        {%- endpaginate -%}
      </div>
    {%- else -%}
      <div class="blog-empty">
        <p>{{ 'blogs.general.no_articles' | t }}</p>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .blog-articles__grid {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .blog-articles--grid .blog-articles__grid {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  }

  .blog-articles--list .blog-articles__grid {
    grid-template-columns: 1fr;
  }

  .blog-article-card {
    display: flex;
    flex-direction: column;
    border: 1px solid rgb(var(--color-border));
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .blog-article-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .blog-article-card__image-wrapper {
    display: block;
    overflow: hidden;
    min-height: 200px;
    background: rgb(var(--color-border));
  }

  .blog-article-card__image {
    width: 100%;
    transition: transform 0.3s;
  }

  .blog-article-card__image .placeholder-svg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  .blog-article-card:hover .blog-article-card__image img {
    transform: scale(1.05);
  }

  .media--portrait {
    padding-bottom: 133.33%;
  }

  .media--square {
    padding-bottom: 100%;
  }

  .media--landscape {
    padding-bottom: 66.67%;
  }

  .blog-article-card__content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  .blog-article-card__info {
    display: flex;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
    font-size: 1.1rem;
    color: rgb(var(--color-text) / 0.7);
  }

  .blog-article-card__title {
    margin: 0 0 0.8rem;
    font-size: 1.6rem;
    font-weight: 700;
    line-height: 1.3;
  }

  .blog-article-card__title a {
    color: inherit;
    text-decoration: none;
  }

  .blog-article-card__title a:hover {
    color: rgb(var(--color-accent));
  }

  .blog-article-card__excerpt {
    margin-bottom: 1rem;
    color: rgb(var(--color-text) / 0.8);
  }
  }

  .blog-article-card__link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: rgb(var(--color-accent));
    font-weight: 600;
    text-decoration: none;
    transition: gap 0.2s;
  }

  .blog-article-card__link:hover {
    gap: 1rem;
  }

  .blog-article-card__link svg {
    width: 16px;
    height: 16px;
  }

  @media (max-width: 749px) {
    .blog-articles__grid {
      gap: 1.5rem;
    }

    .blog-article-card__content {
      padding: 1.2rem;
    }

    .blog-article-card__title {
      font-size: 1.4rem;
    }
  }
</style>

{% schema %}
{
  "name": "Blog Posts",
  "class": "section-blog",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "list",
          "label": "List"
        }
      ],
      "default": "grid"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "min": 6,
      "max": 24,
      "step": 3,
      "label": "Posts per page",
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "show_featured_image",
      "label": "Show featured image",
      "default": true
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "options": [
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        }
      ],
      "default": "portrait"
    },
    {
      "type": "checkbox",
      "id": "blog_show_author",
      "label": "Show author",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "blog_show_date",
      "label": "Show date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "blog_show_excerpt",
      "label": "Show excerpt",
      "default": true
    }
  ]
}
{% endschema %}
